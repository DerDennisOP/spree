<% content_for :page_title do %>
  <%= page_header_back_button spree.admin_promotions_path, @promotion %>
  <%= @promotion.name %>
<% end %>

<% content_for :page_actions do %>
  <%= link_to spree.admin_promotion_coupon_codes_path(@promotion, format: :csv), class: 'btn btn-light bg-transparent with-tip', title: 'Download coupons ad a CSV file' do %>
    <%= icon 'download' %>
    <%= Spree.t(:download) %>
  <% end %>
<% end %>

<%= turbo_frame_tag :coupon_codes do %>

  <ul id="table-tabs" class="nav nav-pills d-inline-flex mb-3">
    <li class="nav-item">
      <%= link_to Spree.t('admin.orders.all'),
        spree.admin_promotion_coupon_codes_path,
        class: "nav-link #{'active' if (params[:q] || {}).values_at(:state_eq ).all?(&:blank?)}" %>
    </li>

    <li class="nav-item">
      <%= link_to Spree.t('admin.coupon_codes.used'),
        params.merge({q: {state_eq: :used}}).permit!,
        class: "nav-link #{'active' if params.dig(:q, :state_eq) == 'used'}" %>
    </li>

    <li class="nav-item">
      <%= link_to Spree.t('admin.coupon_codes.unused'),
        params.merge({q: {state_eq: :unused}}).permit!,
        class: "nav-link #{'active' if params.dig(:q, :state_eq) == 'unused'}" %>
    </li>
  </ul>

  <div class="table-responsive card-lg p-0">
    <% if @coupon_codes.any? %>
      <table class="table">
        <thead class="text-muted">
        <tr data-hook="rate_header">
          <th><%= Spree.t(:code) %></th>
          <th><%= Spree.t(:used) %></th>
          <th><%= Spree.t(:created_at) %></th>
          <th></th>
        </tr>
        </thead>
        <tbody>
        <%= render collection: @coupon_codes.pluck(:id, :code, :state, :created_at), partial: 'spree/admin/coupon_codes/coupon_code', cached: spree_base_cache_scope %>
        </tbody>
      </table>
    <% else %>
      <div class="text-muted p-5 d-flex align-items-center w-100 justify-content-center">
        <%= Spree.t(:no_resource_found, resource: plural_resource_name(Spree::CouponCode)) %>
      </div>
    <% end %>
  </div>


  <%= render 'spree/admin/shared/index_table_options', collection: @coupon_codes, simple: true if @coupon_codes.any? %>
<% end %>